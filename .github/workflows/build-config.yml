name: build-config
on:
  push:
    branches:
      - master
      - wayland
  pull_request:
    branches:
      - master
    types:
      - opened
      - reopened
      - synchronize

jobs:
  build-home-manager-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Install Nix
        uses: cachix/install-nix-action@v18
        with:
          extra_nix_config: |
            access-tokens = github.com=${{ secrets.GH_TOKEN_FOR_UPDATES }}
      - name: Cachix
        uses: cachix/cachix-action@v10
        with:
          name: rprecenth
          authToken: ${{ secrets.CACHIX_TOKEN }}
      - name: Build config
        run: >
          cachix watch-exec rprecenth nix -- build -j 4 -L .#homeConfigurations."rasmus@kalmiya".activationPackage
