name: build-config
on:
  push:
    branches:
      - master
      - wayland
  pull_request:
    branches:
      - master
    types:
      - opened
      - reopened
      - synchronize

jobs:
  build-home-manager-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Free Disk Space
        uses: jlumbroso/free-disk-space@main
      - name: Install Nix
        uses: cachix/install-nix-action@4e002c8ec80594ecd40e759629461e26c8abed15 # v31
        with:
          extra_nix_config: |
            access-tokens = github.com=${{ secrets.GH_TOKEN_FOR_UPDATES }}
      - name: Cachix
        uses: cachix/cachix-action@3ba601ff5bbb07c7220846facfa2cd81eeee15a1 # v16
        with:
          name: rprecenth
          authToken: ${{ secrets.CACHIX_TOKEN }}
          extraPullNames: nix-community
      - name: Build config
        run: >
          cachix watch-exec rprecenth nix -- run github:Mic92/nix-fast-build -- --no-nom --skip-cached --flake .#homeConfigurations."rasmus@kalmiya".activationPackage
